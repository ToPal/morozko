/**
 * cbpBGSlideshow.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2013, Codrops
 * http://www.codrops.com
 */
function getcbpBGSlideshow() {

    var max_opacity = 0.5;
 
    var $slideshow = $( '#imgs' );
    var $items = $slideshow.children( 'li' );
    var itemsCount = $items.length;
    var $controls = $( '#cbp-bicontrols' );
        // индекс объекта
    var current = 0;
        // счётчик
    var slideshowtime;
        // true если стайд-шоу активно
    var isSlideshowActive = true;
        // засекаем 3.5 секунды для смены изображений
    var interval = 5000;
 
    function init( config ) {
 
        // подгружаем изображения
        $slideshow.imagesLoaded( function() {
 
            if( Modernizr.backgroundsize ) {
                $items.each( function() {
                    var $item = $( this );
                    $item.css( 'background-image', 'url(' + $item.find( 'img' ).attr( 'src' ) + ')' );
                } );
            }
            else {
                $slideshow.find( 'img' ).show();
                // для старых браузеров добавляем фолбэк
            }
            // показываем первый объект
            $items.eq( current ).css( 'opacity', max_opacity );
            // начинаем слайдшоу
            startSlideshow();
 
        } );
 
    }
 
    function navigate( direction ) {
 
        // текущий объект
        var $oldItem = $items.eq( current );
 
        if( direction === 'next' ) {
            current++;
            if (current >= itemsCount) current = 0;
        }
        else if( direction === 'prev' ) {
            current = current < 0 ? --current : itemsCount - 1;
        }
 
        // new item
        var $newItem = $items.eq( current );
        // show / hide items
        // $oldItem.css( 'opacity', 0 );
        // $newItem.css( 'opacity', 1 );
        var duration = "slow";
        $oldItem.animate({ opacity: 0 }, duration);
        $newItem.animate({ opacity: max_opacity }, duration);
 
    }
 
    function startSlideshow() {
 
        isSlideshowActive = true;
        clearTimeout( slideshowtime );
        slideshowtime = setTimeout( function() {
            navigate( 'next' );
            startSlideshow();
        }, interval );
 
    }
 
    function stopSlideshow() {
        isSlideshowActive = false;
        clearTimeout( slideshowtime );
    }
 
    return { init : init };
 
};